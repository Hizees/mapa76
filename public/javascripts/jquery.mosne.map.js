(function(a){a.fn.mosne_map=function(b){var c={zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP};defaults={elements:"#list .maplocation",map_opt:c,clat:41.895466,clng:12.482324,mapstyle_name:"",mapstyle:"",cluster_styles:{},marker_icon:"",infobox:!0,trigger:"map_open",clickedzoom:15,timeout:100,mode:"latlng",wait:500,showzoom:!1,before:function(){},after:function(){},afterUpdate:function(){}};var d=a.extend({},defaults,b);this.each(function(){var b=a(this),c=a(this).get(0);d.before.apply(b);var e=new google.maps.LatLng(d.clat,d.clng),f=new google.maps.Map(c,d.map_opt),g=new google.maps.LatLngBounds,h=new MarkerClusterer(f,null,d.cluster_styles);f.setCenter(e);if(d.mapstyle_name!=""){var i={name:d.mapstyle_name},j=new google.maps.StyledMapType(d.mapstyle,i);f.mapTypes.set(d.mapstyle_name,j),f.setMapTypeId(d.mapstyle_name)}if(d.marker_icon!="")var k=new google.maps.MarkerImage(d.marker_icon,new google.maps.Size(21,34));if(d.infobox)var l=new google.maps.InfoWindow({maxWidth:80});var m=function(b,c,e,i){var j=new google.maps.Marker({position:c,icon:e,title:i});g.extend(c);if(d.infobox)var k=b.find(".infobox").html();google.maps.event.addListener(j,"click",function(){d.infobox&&(l.close(),l.setContent(k),l.open(f,j)),b.trigger(d.trigger),console.log(1),a(b).parents().find(".active").removeClass("active"),a(b).addClass("active"),setTimeout(function(){f.setZoom(d.clickedzoom),f.panTo(c),j.setAnimation(google.maps.Animation.DROP)},d.timeout)}),a(b).find(".maplink").unbind("click").bind("click",function(a){a.preventDefault(),google.maps.event.trigger(j,"click");return!1}),h.addMarker(j)};a(b).bind("update",function(){h.clearMarkers(),g=null,g=new google.maps.LatLngBounds;var c=[],e=0;if(d.mode==="address")var i=new google.maps.Geocoder;a(d.elements).each(function(b){var c=a(this);if(d.mode==="address"){delay=d.wait;var e=a(this).find(".name").text(),h=a(this).find(".address").text();setTimeout(function(){i.geocode({address:h},function(b,d){d==google.maps.GeocoderStatus.OK?(l=b[0].geometry.location,m(c,l,k,e),f.fitBounds(g)):a(c).css({opacity:.35})})},delay)}else{var j=c.data(),l=new google.maps.LatLng(j.lat,j.lng);m(c,l,k,j.name)}}),d.mode==="latlng"&&f.fitBounds(g),d.afterUpdate.apply(b)}).trigger("update"),a(b).bind("bounds",function(){f.fitBounds(g)}),d.showzoom&&google.maps.event.addListener(f,"zoom_changed",function(){a(b).trigger("showzoom",[f.getZoom()])}),d.after.apply(b);return!0})}})(jQuery)