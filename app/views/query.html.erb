<script>
   var tl;
   var resizeTimerID = null;

   $(document).ready(function () { 
       var eventSource = new Timeline.DefaultEventSource();
       var bandInfos = [
         Timeline.createBandInfo({
             eventSource:    eventSource,
             date:           "1977-06-09",
             width:          "70%", 
             intervalUnit:   Timeline.DateTime.MONTH, 
             intervalPixels: 100
         }),
         Timeline.createBandInfo({
             eventSource:    eventSource,
             date:           "1977-06-09",
             width:          "30%", 
             intervalUnit:   Timeline.DateTime.YEAR, 
             intervalPixels: 100
         })
       ];
       tl = Timeline.create(document.getElementById("timeline"), bandInfos);
       Timeline.loadJSON("/timeline_json?ids=<%=@persons.map(&:id).join(",")%>", function(json, url) { 
           console.log("from: ",url)
           console.log(json)
           eventSource.loadJSON(json, url); 
       })
   });
   $(document).resize(function () { 
         if (resizeTimerID == null) {
             resizeTimerID = window.setTimeout(function() {
                 resizeTimerID = null;
                 tl.layout();
             }, 500);
         }
    });
</script>

<div id="timeline" style="height: 400px; border: 1px solid #aaa"></div>

<%@persons.each{|person|%>
  <h2><%=link_to person.name,url_for(:index, :ids => person.id)%></h2>
  <table>
    <%person.milestones.each{|milestone|%>
      <tr>
        <td class='from'><%=milestone.date_from_range%></td>
        <td class='to'><%=milestone.date_to_range%></td>
        <td class='what'><%=milestone.what%></td>
        <td class='where'><%=milestone.where%></td>
      </tr>
    <%}%>
  </table>
<%}%>
