-# coding: utf-8
- content_for :javascripts do
  = javascript_include_tag "comb"
  :javascript
    var app = null;
    $(function() {
      app = new AppView({
        document: #{@doc.attributes.slice(*%w{
          _id category created_at description fontspecs heading information
          last_analysis_at original_file state title
        }).to_json}
      });
      app.document.pages.reset(#{@pages.to_json(:methods => :named_entities)});
      app.render();
    });

/ Document fontspec CSS classes
- @doc.fontspecs.each do |id, fs|
  :css
    .page p.fs#{id} {
      font-family: #{fs["family"]};
      font-size: #{fs["size"]}px;
      color: #{fs["color"]};
    }

/ Document content
.row-fluid
  .document
    %h2{:id => "document-heading", "data-document-id" => @doc.id}
      = @doc.heading
    .pages
      - @empty_pages.each do |page|
        .page.empty{:id => page.num, :"data-id" => page.id, :style => "width: 100%; height: #{page.height}px"}

-#
  .row-fluid
    .pages
    - if @paragraphs.length > 1
      .next_page
        = link_to "Cargar más contenido", url_for(:documents, :comb,
          :id => "next_page",
          :"data-next" => params[:page].to_i + 2,
          :"data-document" => @doc.id
      #loading{:style => "display:none; text-align: center;"}
        = image_tag 'ajax-bar-loader.gif', :style => "margin:0 auto;"

- content_for :sidebar do
  %ul.nav.nav-list#sidebar
    .alert.alert-error#registers-error{style: "display: none;"}
      %a.close{href: '#', data: { dismiss: "alert" }}
      %strong
        Aviso
      Los registros no han sido guardados.

    .alert.alert-success#registers-save{style: "display: none;"}
      %a.close{href: '#', data: { dismiss: "alert" }}
      %strong
        Aviso
      Los registros han sido guardados.

    %li.nav-header
      Referencias
    %ul#reference
      %li.people
        %input{:type => "checkbox", :id => :people_ref, :checked => true}
        %label{:for => :people_ref} Personas
      %li.organizations
        %input{:type => "checkbox", :id => :organizations_ref, :checked => true}
        %label{:for => :organizations_ref} Organizaciones
      %li.places
        %input{:type => "checkbox", :id => :places_ref, :checked => true}
        %label{:for => :places_ref} Lugares
      %li.dates
        %input{:type => "checkbox", :id => :dates_ref, :checked => true}
        %label{:for => :dates_ref} Fechas
      %li.actions
        %input{:type => "checkbox", :id => :actions_ref, :checked => true}
        %label{:for => :actions_ref} Acciones

    %li.nav-header#registers Hechos

    %li.nav-header Contexto
    .context#context

/ Templates
%script#pre-register-template{:type => "text/template"}
  .register{:class => "{{type}} {{ne_class}}", "data-ne-id" => "{{id}}"}
    {{text}}
    %button.close
      ×

%script#document-context-template{:type => "text/template"}
  .breadcrumb
    %a{:href => "/documents/{{id}}"}
      {{heading}}
  .information
    .title
      {{heading}}
    .category
      Categoría: {{category}}

%script#person-context{:type => "text/template"}
  .breadcrumb
    %a{:href => "/documents/#{@doc.id}"}
      = @doc.heading
    >
    %a{:href => "/person/{{id}}"}
      {{name}}
  .information
    .field
      Nombre: {{full_name}}
    .field
      Tags:
      {{#tags}}
      %a{:href => "{{tag_link}}"}
        {{.}}
      {{/tags}}
    .field
      Documentos:
      {{#documents}}
      %a{:href => "/documents/{{id}}"}
        {{name}}
      {{/documents}}

%script#page-template{:type => "text/template"}
  .page-content{:style => "display: none"}

%script#empty-fact-register{:type => "text/template"}
  Arrastre un
  %strong nombre de persona
  aquí para crear un nuevo hecho.
